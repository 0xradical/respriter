#!/usr/bin/env sh

if [ $1 = "prd" ]; then
  eval `heroku config -s -a napoleon-the-crawler`
else
  eval `heroku config -s -a napoleon-$1`
fi

eval `heroku config -s -a napoleon-postgrest-$1`

cat << EOF > envs/$1/database.env
# Database Url
POSTGRES_URL="$DATABASE_URL"

# Postgres Docker
POSTGRES_DB=`./bin/parse_uri $DB_URI path`

# Config
API_SCHEMA=$DB_SCHEMA
API_ANONYMOUS_ROLE=$DB_ANON_ROLE

# Secrets
AUTHENTICATOR_USER=`./bin/parse_uri $DB_URI user`
AUTHENTICATOR_PASSWORD=`./bin/parse_uri $DB_URI password`
JWT_SECRET=$JWT_SECRET
EOF

echo "Created env file ./envs/$1/database.env with envs from $1"
