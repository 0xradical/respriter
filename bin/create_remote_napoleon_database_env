#!/usr/bin/env sh

SCRIPT_PATH="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"

napoleon_app=`$SCRIPT_PATH/remote_alias napoleon-$1`
eval `heroku config -s -a $napoleon_app`

napoleon_api=`$SCRIPT_PATH/remote_alias napoleon-api-$1`
eval `heroku config -s -a $napoleon_api`

parse_uri="$SCRIPT_PATH/parse_uri"

cat << EOF > $2
# Database Url
POSTGRES_URL=$DATABASE_URL
DB_ENV=$1

# Postgres Docker
POSTGRES_DB=`$parse_uri $DB_URI path`

# User Passwords
GRAFANA_PASSWORD=$GRAFANA_PASSWORD

# Config
API_SCHEMA=$DB_SCHEMA
API_ANONYMOUS_ROLE=$DB_ANON_ROLE

# Secrets
AUTHENTICATOR_USER=`$parse_uri $DB_URI user`
AUTHENTICATOR_PASSWORD=`$parse_uri $DB_URI password`
JWT_SECRET=$JWT_SECRET
EOF

echo "Created env file $2 with envs from $1"
