#!/usr/bin/env bash

if [[ ! $1 = 'dev' ]]; then
  read -r -p "Are You Sure? [Y/n] " am_sure
  if [[ ! $am_sure =~ ^[Yy]$ ]]; then
    echo 'Reset Database Aborted!'
    exit 1
  fi
fi

until pg_isready -U `./bin/parse_uri $POSTGRES_URL user` -h `./bin/parse_uri $POSTGRES_URL host`; do sleep 0.5; done;

database_db=`./bin/parse_uri $POSTGRES_URL path`
database_host=`./bin/parse_uri $POSTGRES_URL host`
database_password=`./bin/parse_uri $POSTGRES_URL password`
database_port=`./bin/parse_uri $POSTGRES_URL port`
database_user=`./bin/parse_uri $POSTGRES_URL user`

PGPASSWORD=$database_password dropdb   -U $database_user -h $database_host -p $database_port $database_db
PGPASSWORD=$database_password createdb -U $database_user -h $database_host -p $database_port $database_db
