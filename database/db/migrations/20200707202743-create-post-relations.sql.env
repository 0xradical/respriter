BEGIN;

CREATE TABLE app.post_relations (
  id            uuid DEFAULT public.uuid_generate_v4() PRIMARY KEY,
  relation_type varchar NOT NULL,
  relation_id   uuid NOT NULL,
  post_id       uuid REFERENCES app.posts(id)
);

CREATE INDEX index_post_relations_on_post_id
ON app.post_relations
USING btree (post_id);

CREATE INDEX index_post_relations_on_relation_fields
ON app.post_relations
USING btree (relation_id, relation_type);

CREATE UNIQUE INDEX index_post_relations_unique
ON app.post_relations
USING btree (relation_id, relation_type, post_id);

GRANT SELECT, INSERT, UPDATE, DELETE, REFERENCES ON app.post_relations TO "admin";
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA app TO "admin";

INSERT INTO public.schema_migrations (version) VALUES ('20200707202743');

COMMIT;
