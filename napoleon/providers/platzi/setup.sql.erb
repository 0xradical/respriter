-- auto-generated, do not change!
-- run `make build-seeds` instead

INSERT INTO app.pipeline_templates (
  name,
  data,
  bootstrap_script_type,
  bootstrap_script,
  dataset_id,
  pipes
) VALUES (
  'Platzi Brute Page Crawler',
  jsonb_build_object('home_url', '<%= home_url %>'),
  'sql',
  '
    INSERT INTO app.pipe_processes (pipeline_id, initial_accumulator) VALUES ($1.id, jsonb_build_object(''url'', $1.data->>''home_url''));
    SELECT pipeline_call($1.id);
  ',
  '<%= dataset_id %>',
  '[
    {
      "type": "Fetcher",
      "http": {
        "headers": {
          "user_agent":      "<%= user_agent %>",
          "accept":          "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
          "accept_language": "en-US,en;q=0.8,q=0.5,*;q=0.3"
        },
        "follow_redirects": {
          "limit": 100
        }
      },
      "status_map": [
        [ [ 200, 299 ], "pending" ],
        [ [ 403, 404 ], "skipped" ]
      ]
    },
    {
      "type": "Spider",
      "url_blacklist": [
        "platzi.com/@",
        "platzi.com/clases/",
        "platzi.com/comentario/",
        "platzi.com/comprar/",
        "platzi.com/adquirir",
        "platzi.com/blog",
        "platzi.com/discusiones",
        "http://www.platzi.com/",
        "http://platzi.com/"
      ],
      "script": {
        "type":        "ruby",
        "source_code": <%= brute_crawler_spider %>
      }
    },
    {
      "type": "ResourceCreator",
      "script": {
        "type": "ruby",
        "source_code": <%= brute_crawler_course %>
      }
    }
  ]'
);
