#!/usr/bin/env bash

source $1

if [[ ! $1 =~ 'dev' ]]; then
  echo "\033[0;31mPay attention this not development env, it is $1\033[0m"
fi

count=1
until pg_isready -U `./bin/parse_uri $POSTGRES_URL user` -h `./bin/parse_uri $POSTGRES_URL host` > /dev/null; do
  sleep 1;
  if [ $count -gt 10 ]; then
    exit -1
  else
    count=$((count+1))
  fi;
done;

psql $(echo $POSTGRES_URL | cut -d\? -f1) ${*:2}

exit 0
